---
import type { GiscusComment } from "../utils/giscus-utils";
import { getPostUrlBySlug } from "../utils/url-utils";

interface Props {
	comments: GiscusComment[];
	limit?: number;
}

const { comments, limit = 10 } = Astro.props;
const displayedComments = comments.slice(0, limit);
---

<div class="card-base rounded-[var(--radius-large)] p-6 mb-8">
  <h2 class="text-2xl font-bold mb-6 text-[var(--deep-text)]">最新评论</h2>
  
  {displayedComments.length > 0 ? (
    <div class="space-y-4">
      {displayedComments.map((comment, index) => (
        <div 
          class="p-4 rounded-[var(--radius-medium)] border border-[var(--line-color)] hover:shadow-md transition-shadow"
        >
          <div class="flex items-start gap-3">
            <!-- 作者头像 -->
            <img 
              src={comment.author.avatarUrl} 
              alt={comment.author.login} 
              class="w-10 h-10 rounded-full object-cover flex-shrink-0"
            />
            
            <!-- 评论内容 -->
            <div class="flex-1 min-w-0">
              <!-- 作者和时间 -->
              <div class="flex flex-wrap items-center gap-x-2 gap-y-1 mb-2">
                <span class="font-medium text-[var(--text-primary)]">{comment.author.login}</span>
                <span class="text-xs text-[var(--text-secondary)]">
                  {new Date(comment.createdAt).toLocaleString("zh-CN", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                    hour: "2-digit",
                    minute: "2-digit"
                  })}
                </span>
              </div>
              
              <!-- 评论正文 -->
              <div 
                class="text-[var(--text-primary)] mb-3 line-clamp-3"
                set:html={comment.body}
              ></div>
              
              <!-- 来源文章信息 -->
              {comment.postSlug && comment.postTitle ? (
                <div class="flex items-center gap-2">
                  <span class="text-xs text-[var(--text-secondary)]">来自：</span>
                  <a 
                    href={getPostUrlBySlug(comment.postSlug)} 
                    class="text-xs text-[var(--primary)] hover:underline line-clamp-1"
                  >
                    {comment.postTitle}
                  </a>
                </div>
              ) : null}
            </div>
          </div>
        </div>
      ))}
    </div>
  ) : (
    <div class="text-center py-8 text-[var(--text-secondary)]">
      暂无评论
    </div>
  )}
  
  {comments.length > limit ? (
    <div class="text-center mt-6">
      <span class="text-sm text-[var(--secondary-text)]">
        只显示最新 {limit} 条评论，共 {comments.length} 条
      </span>
    </div>
  ) : null}
</div>
